#!/bin/sh
# Git hook to automatically update submodules when switching branches
# Only runs for rewardStyle repositories

# Get the current repository's remote URL
REMOTE_URL=$(git config --get remote.origin.url 2>/dev/null)

# Check if this is a rewardStyle repository
# Handles both SSH and HTTPS URLs
if echo "$REMOTE_URL" | grep -qE "(rewardStyle|rewardstyle|github\.com[:/]rewardStyle)" 2>/dev/null; then
    # The three parameters passed to post-checkout hook:
    # $1 = previous HEAD
    # $2 = new HEAD  
    # $3 = flag (1 if checking out a branch, 0 if checking out files)
    
    # Only run when checking out a branch (not individual files)
    if [ "$3" = "1" ]; then
        # Check if the repository has submodules
        if [ -f .gitmodules ]; then
            echo "üì¶ Updating submodules for rewardStyle repository..."
            
            # Initialize submodules if needed
            git submodule init
            
            # Update submodules to match the current branch
            git submodule update --checkout
            
            if [ $? -eq 0 ]; then
                echo "‚úÖ Submodules updated successfully"
            else
                echo "‚ö†Ô∏è  Warning: Failed to update some submodules"
            fi
        fi
    fi
fi

# Always exit successfully to not block the checkout
exit 0