#!/usr/bin/env bash

# Script to install Go formatting pre-commit hook in current repository

set -e

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Check if we're in a git repository
if ! git rev-parse --git-dir > /dev/null 2>&1; then
  echo -e "${RED}Error: Not in a git repository${NC}"
  exit 1
fi

GIT_DIR=$(git rev-parse --git-dir)
HOOK_DIR="$GIT_DIR/hooks"

echo "Installing Go format pre-commit hook..."

# Create hooks directory if it doesn't exist
mkdir -p "$HOOK_DIR"

# Copy the hooks
cp ~/.config/git/hooks/pre-commit-go-format "$HOOK_DIR/"
cp ~/.config/git/hooks/pre-commit "$HOOK_DIR/"

# Make them executable
chmod +x "$HOOK_DIR/pre-commit" "$HOOK_DIR/pre-commit-go-format"

echo -e "${GREEN}✓ Pre-commit hook installed successfully!${NC}"
echo ""
echo "The hook will:"
echo "  • Format all staged Go files with goimports and gofumpt"
echo "  • Run go vet to catch common mistakes"
echo "  • Re-stage formatted files automatically"
echo "  • Block commits if formatting fails"
echo ""
echo -e "${YELLOW}Note: This hook is specific to this repository.${NC}"
echo "To use globally, run: git config --global core.hooksPath ~/.config/git/hooks"